{
  "goid": "d40638e53c8d106a9ea632841887d560",
  "guid": "e86c13e3-adc5-44d8-bde4-0e2571015f06",
  "name": "#Portal Look Up API Key Cache",
  "policyType": "FRAGMENT",
  "checksum": "8fdde35b37c7744244ab5dbd7dec68f773e36907",
  "folderPath": "/OTK/Customizations",
  "soap": false,
  "policy": {
    "xml": "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<wsp:Policy xmlns:L7p=\"http://www.layer7tech.com/ws/policy\" xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2002/12/policy\">\n    <wsp:All wsp:Usage=\"Required\">\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\"Policy Fragment: #Portal Look Up API Key Cache\"/>\n        </L7p:CommentAssertion>\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\"=====Portal APIKey Cache lookup logic=====\"/>\n        </L7p:CommentAssertion>\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\"=====Looks APIKey in GW cache. Expects CWPs cluster.otk.portalapikeylookup.cacheid, cluster.otk.portalapikeylookup.cache.ag_s=====\"/>\n        </L7p:CommentAssertion>\n        <L7p:CommentAssertion>\n            <L7p:Comment stringValue=\"=====24-03-2023=====\"/>\n        </L7p:CommentAssertion>\n        <wsp:All wsp:Usage=\"Required\">\n            <L7p:AuditDetailAssertion>\n                <L7p:Detail stringValue=\"apikey going through cache\"/>\n                <L7p:Level stringValue=\"WARNING\"/>\n            </L7p:AuditDetailAssertion>\n            <L7p:CacheLookup>\n                <L7p:CacheEntryKey stringValue=\"${apikey}_${serviceid}\"/>\n                <L7p:CacheId stringValue=\"${gateway.cluster.otk.portalapikeylookup.cacheid}\"/>\n                <L7p:ContentTypeOverride stringValue=\"\"/>\n                <L7p:MaxEntryAgeSeconds stringValue=\"${gateway.cluster.otk.portalapikeylookup.cache.age_s}\"/>\n                <L7p:OtherTargetMessageVariable stringValue=\"resp\"/>\n                <L7p:Target target=\"OTHER\"/>\n            </L7p:CacheLookup>\n            <L7p:ComparisonAssertion>\n                <L7p:Expression1 stringValue=\"${resp.mainpart}\"/>\n                <L7p:Expression2 stringValue=\"value\"/>\n                <L7p:Operator operator=\"CONTAINS\"/>\n                <L7p:Predicates predicates=\"included\">\n                    <L7p:item binary=\"included\">\n                        <L7p:Operator operator=\"CONTAINS\"/>\n                        <L7p:RightValue stringValue=\"value\"/>\n                    </L7p:item>\n                </L7p:Predicates>\n            </L7p:ComparisonAssertion>\n            <L7p:AuditDetailAssertion>\n                <L7p:Detail stringValue=\"apikey completed going through cache\"/>\n                <L7p:Level stringValue=\"WARNING\"/>\n            </L7p:AuditDetailAssertion>\n            <L7p:assertionComment>\n                <L7p:Properties mapValue=\"included\">\n                    <L7p:entry>\n                        <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                        <L7p:value stringValue=\"cache lookup\"/>\n                    </L7p:entry>\n                </L7p:Properties>\n            </L7p:assertionComment>\n        </wsp:All>\n    </wsp:All>\n</wsp:Policy>\n"
  }
}